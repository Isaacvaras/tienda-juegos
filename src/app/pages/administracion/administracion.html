<div class="container py-4">
  <h1 class="h4 mb-3">Panel de administración</h1>
  <p class="text-muted small mb-4">
    Compras realizadas en la tienda. Marca las que ya pasaron a almacén.
  </p>

  <div *ngIf="compras.length === 0" class="alert alert-info">
    Aún no hay compras registradas.
  </div>

  <div *ngIf="compras.length > 0" class="card shadow-sm">
    <div class="card-body p-3 p-md-4">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>#</th>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>Dirección / Tipo</th>
              <th>Total</th>
              <th>Estado almacén</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of compras; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ c.fecha | date:'short' }}</td>
              <td>{{ c.userCorreo }}</td>
              <td>
                <div *ngIf="c.direccion as d; else sinDir">
                  <div class="small">
                    {{ d.calle || '—' }}, {{ d.distrito || '—' }}
                  </div>
                  <div class="small text-muted">
                    {{ d.recogerTienda ? 'Recojo en tienda' : 'Envío a domicilio' }}
                  </div>
                </div>
                <ng-template #sinDir>
                  <span class="small text-muted">Sin dirección registrada</span>
                </ng-template>
              </td>
              <td>S/ {{ c.total | number:'1.2-2' }}</td>
              <td>
                <button
                  type="button"
                  class="btn btn-sm"
                  [ngClass]="c.enviadoAlAlmacen ? 'btn-success' : 'btn-outline-secondary'"
                  (click)="toggleEnviado(c)"
                >
                  {{ c.enviadoAlAlmacen ? 'Pedido Enviado' : 'Marcar enviado' }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <hr class="my-4" />

<h2 class="h5 mb-3">Gestión de stock</h2>

<table class="table table-bordered align-middle">
  <thead>
    <tr>
      <th>Producto</th>
      <th class="text-center">Precio</th>
      <th class="text-center">Stock</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of products">
      <td>{{ p.name }}</td>
      <td class="text-center">S/ {{ p.price | number:'1.2-2' }}</td>
      <td class="text-center">
        <input
          type="number"
          min="0"
          class="form-control form-control-sm text-center"
          [value]="p.stock"
          (change)="updateStock(p.id, $event)"
          style="width: 80px; margin: auto;"
        />
      </td>
    </tr>
  </tbody>
</table>

</div>
